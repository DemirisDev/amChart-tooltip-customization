const data = [
    {
        hour: "12pm",
        weekday: "Mon",
        value: 3346
    }, {
        hour: "1am",
        weekday: "Mon",
        value: 2725
    }, {
        hour: "2am",
        weekday: "Mon",
        value: 3052
    }, {
        hour: "3am",
        weekday: "Mon",
        value: 3876
    }, {
        hour: "4am",
        weekday: "Mon",
        value: 4453
    }, {
        hour: "5am",
        weekday: "Mon",
        value: 3972
    }, {
        hour: "6am",
        weekday: "Mon",
        value: 4644
    }, {
        hour: "7am",
        weekday: "Mon",
        value: 5715
    }, {
        hour: "8am",
        weekday: "Mon",
        value: 7080
    }, {
        hour: "9am",
        weekday: "Mon",
        value: 8022
    }, {
        hour: "10am",
        weekday: "Mon",
        value: 8446
    }, {
        hour: "11am",
        weekday: "Mon",
        value: 9313
    }, {
        hour: "12am",
        weekday: "Mon",
        value: 9011
    }, {
        hour: "1pm",
        weekday: "Mon",
        value: 8508
    }, {
        hour: "2pm",
        weekday: "Mon",
        value: 8515
    }, {
        hour: "3pm",
        weekday: "Mon",
        value: 8399
    }, {
        hour: "4pm",
        weekday: "Mon",
        value: 8649
    }, {
        hour: "5pm",
        weekday: "Mon",
        value: 7869
    }, {
        hour: "6pm",
        weekday: "Mon",
        value: 6933
    }, {
        hour: "7pm",
        weekday: "Mon",
        value: 5969
    }, {
        hour: "8pm",
        weekday: "Mon",
        value: 5552
    }, {
        hour: "9pm",
        weekday: "Mon",
        value: 5434
    }, {
        hour: "10pm",
        weekday: "Mon",
        value: 5070
    }, {
        hour: "11pm",
        weekday: "Mon",
        value: 4851
    }, {
        hour: "12pm",
        weekday: "Tue",
        value: 4468
    }, {
        hour: "1am",
        weekday: "Tue",
        value: 3306
    }, {
        hour: "2am",
        weekday: "Tue",
        value: 3906
    }, {
        hour: "3am",
        weekday: "Tue",
        value: 4413
    }, {
        hour: "4am",
        weekday: "Tue",
        value: 4726
    }, {
        hour: "5am",
        weekday: "Tue",
        value: 4584
    }, {
        hour: "6am",
        weekday: "Tue",
        value: 5717
    }, {
        hour: "7am",
        weekday: "Tue",
        value: 6504
    }, {
        hour: "8am",
        weekday: "Tue",
        value: 8104
    }, {
        hour: "9am",
        weekday: "Tue",
        value: 8813
    }, {
        hour: "10am",
        weekday: "Tue",
        value: 9278
    }, {
        hour: "11am",
        weekday: "Tue",
        value: 10425
    }, {
        hour: "12am",
        weekday: "Tue",
        value: 10137
    }, {
        hour: "1pm",
        weekday: "Tue",
        value: 9290
    }, {
        hour: "2pm",
        weekday: "Tue",
        value: 9255
    }, {
        hour: "3pm",
        weekday: "Tue",
        value: 9614
    }, {
        hour: "4pm",
        weekday: "Tue",
        value: 9713
    }, {
        hour: "5pm",
        weekday: "Tue",
        value: 9667
    }, {
        hour: "6pm",
        weekday: "Tue",
        value: 8774
    }, {
        hour: "7pm",
        weekday: "Tue",
        value: 8649
    }, {
        hour: "8pm",
        weekday: "Tue",
        value: 9937
    }, {
        hour: "9pm",
        weekday: "Tue",
        value: 10286
    }, {
        hour: "10pm",
        weekday: "Tue",
        value: 9175
    }, {
        hour: "11pm",
        weekday: "Tue",
        value: 8581
    }, {
        hour: "12pm",
        weekday: "Wed",
        value: 8145
    }, {
        hour: "1am",
        weekday: "Wed",
        value: 7177
    }, {
        hour: "2am",
        weekday: "Wed",
        value: 5657
    }, {
        hour: "3am",
        weekday: "Wed",
        value: 6802
    }, {
        hour: "4am",
        weekday: "Wed",
        value: 8159
    }, {
        hour: "5am",
        weekday: "Wed",
        value: 8449
    }, {
        hour: "6am",
        weekday: "Wed",
        value: 9453
    }, {
        hour: "7am",
        weekday: "Wed",
        value: 9947
    }, {
        hour: "8am",
        weekday: "Wed",
        value: 11471
    }, {
        hour: "9am",
        weekday: "Wed",
        value: 12492
    }, {
        hour: "10am",
        weekday: "Wed",
        value: 9388
    }, {
        hour: "11am",
        weekday: "Wed",
        value: 9928
    }, {
        hour: "12am",
        weekday: "Wed",
        value: 9644
    }, {
        hour: "1pm",
        weekday: "Wed",
        value: 9034
    }, {
        hour: "2pm",
        weekday: "Wed",
        value: 8964
    }, {
        hour: "3pm",
        weekday: "Wed",
        value: 9069
    }, {
        hour: "4pm",
        weekday: "Wed",
        value: 8898
    }, {
        hour: "5pm",
        weekday: "Wed",
        value: 8322
    }, {
        hour: "6pm",
        weekday: "Wed",
        value: 6909
    }, {
        hour: "7pm",
        weekday: "Wed",
        value: 5810
    }, {
        hour: "8pm",
        weekday: "Wed",
        value: 5151
    }, {
        hour: "9pm",
        weekday: "Wed",
        value: 4911
    }, {
        hour: "10pm",
        weekday: "Wed",
        value: 4487
    }, {
        hour: "11pm",
        weekday: "Wed",
        value: 4118
    }, {
        hour: "12pm",
        weekday: "Thu",
        value: 3689
    }, {
        hour: "1am",
        weekday: "Thu",
        value: 3081
    }, {
        hour: "2am",
        weekday: "Thu",
        value: 6525
    }, {
        hour: "3am",
        weekday: "Thu",
        value: 6228
    }, {
        hour: "4am",
        weekday: "Thu",
        value: 6917
    }, {
        hour: "5am",
        weekday: "Thu",
        value: 6568
    }, {
        hour: "6am",
        weekday: "Thu",
        value: 6405
    }, {
        hour: "7am",
        weekday: "Thu",
        value: 8106
    }, {
        hour: "8am",
        weekday: "Thu",
        value: 8542
    }, {
        hour: "9am",
        weekday: "Thu",
        value: 8501
    }, {
        hour: "10am",
        weekday: "Thu",
        value: 8802
    }, {
        hour: "11am",
        weekday: "Thu",
        value: 9420
    }, {
        hour: "12am",
        weekday: "Thu",
        value: 8966
    }, {
        hour: "1pm",
        weekday: "Thu",
        value: 8135
    }, {
        hour: "2pm",
        weekday: "Thu",
        value: 8224
    }, {
        hour: "3pm",
        weekday: "Thu",
        value: 8387
    }, {
        hour: "4pm",
        weekday: "Thu",
        value: 8218
    }, {
        hour: "5pm",
        weekday: "Thu",
        value: 7641
    }, {
        hour: "6pm",
        weekday: "Thu",
        value: 6469
    }, {
        hour: "7pm",
        weekday: "Thu",
        value: 5441
    }, {
        hour: "8pm",
        weekday: "Thu",
        value: 4952
    }, {
        hour: "9pm",
        weekday: "Thu",
        value: 4643
    }, {
        hour: "10pm",
        weekday: "Thu",
        value: 4393
    }, {
        hour: "11pm",
        weekday: "Thu",
        value: 4017
    }, {
        hour: "12pm",
        weekday: "Fri",
        value: 4022
    }, {
        hour: "1am",
        weekday: "Fri",
        value: 3063
    }, {
        hour: "2am",
        weekday: "Fri",
        value: 3638
    }, {
        hour: "3am",
        weekday: "Fri",
        value: 3968
    }, {
        hour: "4am",
        weekday: "Fri",
        value: 4070
    }, {
        hour: "5am",
        weekday: "Fri",
        value: 4019
    }, {
        hour: "6am",
        weekday: "Fri",
        value: 4548
    }, {
        hour: "7am",
        weekday: "Fri",
        value: 5465
    }, {
        hour: "8am",
        weekday: "Fri",
        value: 6909
    }, {
        hour: "9am",
        weekday: "Fri",
        value: 7706
    }, {
        hour: "10am",
        weekday: "Fri",
        value: 7867
    }, {
        hour: "11am",
        weekday: "Fri",
        value: 8615
    }, {
        hour: "12am",
        weekday: "Fri",
        value: 8218
    }, {
        hour: "1pm",
        weekday: "Fri",
        value: 7604
    }, {
        hour: "2pm",
        weekday: "Fri",
        value: 7429
    }, {
        hour: "3pm",
        weekday: "Fri",
        value: 7488
    }, {
        hour: "4pm",
        weekday: "Fri",
        value: 7493
    }, {
        hour: "5pm",
        weekday: "Fri",
        value: 6998
    }, {
        hour: "6pm",
        weekday: "Fri",
        value: 5941
    }, {
        hour: "7pm",
        weekday: "Fri",
        value: 5068
    }, {
        hour: "8pm",
        weekday: "Fri",
        value: 4636
    }, {
        hour: "9pm",
        weekday: "Fri",
        value: 4241
    }, {
        hour: "10pm",
        weekday: "Fri",
        value: 3858
    }, {
        hour: "11pm",
        weekday: "Fri",
        value: 3833
    }, {
        hour: "12pm",
        weekday: "Sat",
        value: 3503
    }, {
        hour: "1am",
        weekday: "Sat",
        value: 2842
    }, {
        hour: "2am",
        weekday: "Sat",
        value: 2808
    }, {
        hour: "3am",
        weekday: "Sat",
        value: 2399
    }, {
        hour: "4am",
        weekday: "Sat",
        value: 2280
    }, {
        hour: "5am",
        weekday: "Sat",
        value: 2139
    }, {
        hour: "6am",
        weekday: "Sat",
        value: 2527
    }, {
        hour: "7am",
        weekday: "Sat",
        value: 2940
    }, {
        hour: "8am",
        weekday: "Sat",
        value: 3066
    }, {
        hour: "9am",
        weekday: "Sat",
        value: 3494
    }, {
        hour: "10am",
        weekday: "Sat",
        value: 3287
    }, {
        hour: "11am",
        weekday: "Sat",
        value: 3416
    }, {
        hour: "12am",
        weekday: "Sat",
        value: 3432
    }, {
        hour: "1pm",
        weekday: "Sat",
        value: 3523
    }, {
        hour: "2pm",
        weekday: "Sat",
        value: 3542
    }, {
        hour: "3pm",
        weekday: "Sat",
        value: 3347
    }, {
        hour: "4pm",
        weekday: "Sat",
        value: 3292
    }, {
        hour: "5pm",
        weekday: "Sat",
        value: 3416
    }, {
        hour: "6pm",
        weekday: "Sat",
        value: 3131
    }, {
        hour: "7pm",
        weekday: "Sat",
        value: 3057
    }, {
        hour: "8pm",
        weekday: "Sat",
        value: 3227
    }, {
        hour: "9pm",
        weekday: "Sat",
        value: 3060
    }, {
        hour: "10pm",
        weekday: "Sat",
        value: 2855
    }, {
        hour: "11pm",
        weekday: "Sat",
        value: 2625
    },
    {
        hour: "12pm",
        weekday: "Sun",
        value: 2990
    }, {
        hour: "1am",
        weekday: "Sun",
        value: 2520
    }, {
        hour: "2am",
        weekday: "Sun",
        value: 2334
    }, {
        hour: "3am",
        weekday: "Sun",
        value: 2230
    }, {
        hour: "4am",
        weekday: "Sun",
        value: 2325
    }, {
        hour: "5am",
        weekday: "Sun",
        value: 2019
    }, {
        hour: "6am",
        weekday: "Sun",
        value: 2128
    }, {
        hour: "7am",
        weekday: "Sun",
        value: 2246
    }, {
        hour: "8am",
        weekday: "Sun",
        value: 2421
    }, {
        hour: "9am",
        weekday: "Sun",
        value: 2788
    }, {
        hour: "10am",
        weekday: "Sun",
        value: 2959
    }, {
        hour: "11am",
        weekday: "Sun",
        value: 3018
    }, {
        hour: "12am",
        weekday: "Sun",
        value: 3154
    }, {
        hour: "1pm",
        weekday: "Sun",
        value: 3172
    }, {
        hour: "2pm",
        weekday: "Sun",
        value: 3368
    }, {
        hour: "3pm",
        weekday: "Sun",
        value: 3464
    }, {
        hour: "4pm",
        weekday: "Sun",
        value: 3746
    }, {
        hour: "5pm",
        weekday: "Sun",
        value: 3656
    }, {
        hour: "6pm",
        weekday: "Sun",
        value: 3336
    }, {
        hour: "7pm",
        weekday: "Sun",
        value: 3292
    }, {
        hour: "8pm",
        weekday: "Sun",
        value: 3269
    }, {
        hour: "9pm",
        weekday: "Sun",
        value: 3300
    }, {
        hour: "10pm",
        weekday: "Sun",
        value: 3403
    }, {
        hour: "11pm",
        weekday: "Sun",
        value: 3323
    }
];

// Helper function to calculate the next hour in 12-hour format
function getNextHour(hour) {
    var hours12 = ["12am", "1am", "2am", "3am", "4am", "5am", "6am", "7am", "8am", "9am", "10am", "11am",
        "12pm", "1pm", "2pm", "3pm", "4pm", "5pm", "6pm", "7pm", "8pm", "9pm", "10pm", "11pm"];

    var index = hours12.indexOf(hour);
    if (index === -1 || index === hours12.length - 1) {
        return hours12[0]; // Handle case where hour is 11pm, roll back to 12am
    } else {
        return hours12[index + 1]; // Get the next hour
    }
}

// Function to calculate position of marker based on value
function getMarkerPosition(value, minValue, maxValue) {
    return (value - minValue) / (maxValue - minValue) * 100;
}

// Add `nextHour` and `markerPosition` to the data
var minValue = 1000; // Minimum value for the gradient
var maxValue = 13000; // Maximum value for the gradient

data.forEach(function (item) {
    item.nextHour = getNextHour(item.hour); // Calculate and add nextHour field
    item.markerPosition = getMarkerPosition(item.value, minValue, maxValue); // Pre-calculate marker position
});

am5.ready(function () {

    // Create root element
    var root = am5.Root.new("chartdiv");

    // Set themes
    root.setThemes([
        am5themes_Animated.new(root)
    ]);

    // Create chart
    var chart = root.container.children.push(am5xy.XYChart.new(root, {
        panX: false,
        panY: false,
        wheelX: "none",
        wheelY: "none",
        paddingLeft: 0,
        paddingRight: 0,
        layout: root.verticalLayout
    }));

    // Create reversed Y-axis (Time)
    var yAxis = chart.yAxes.push(am5xy.CategoryAxis.new(root, {
        renderer: am5xy.AxisRendererY.new(root, {
            minGridDistance: 30,
            inversed: true, // This reverses the Y-axis
        }),
        categoryField: "hour"
    }));

    // Create X-axis (Weekday) - labels on top
    var xAxis = chart.xAxes.push(am5xy.CategoryAxis.new(root, {
        renderer: am5xy.AxisRendererX.new(root, {
            minGridDistance: 60,
            opposite: true, // This places the labels on top of the chart
        }),
        categoryField: "weekday"
    }));

    // Create series
    var series = chart.series.push(am5xy.ColumnSeries.new(root, {
        xAxis: xAxis,
        yAxis: yAxis,
        clustered: false,
        valueField: "value",
        categoryXField: "weekday",
        categoryYField: "hour"
    }));

    series.columns.template.setAll({
        width: am5.percent(100),
        height: am5.percent(100),
        stroke: am5.color(0xFFFFFF),
        tooltipX: am5.percent(70),  // Position tooltip on the right
        tooltipY: am5.percent(50),   // Center vertically on the column
        tooltip: am5.Tooltip.new(root, {
            pointerOrientation: "horizontal", // Adjusts the pointer direction to point horizontally
            getFillFromSprite: false, // Prevent inheriting fill from the column
            getStrokeFromSprite: false,
            autoTextColor: false,
            background: am5.Rectangle.new(root, {
                fill: am5.color(0xffffff), // Tooltip background color
                fillOpacity: 0.8,
                stroke: am5.color(0x000000), // Tooltip border color
                strokeWidth: 1
            }),
        })
    });

    // Add custom gradient to tooltip (without value)
    series.columns.template.set("tooltipHTML", `
        <div style="display: flex; padding: 5px; font-size: 12px;">
            <div style="margin-right: 1rem;">
                <b>{weekday}</b><br>
                {hour} - {nextHour}
            </div>
            <div style="display: flex;">
                <div style="height: 100px; width: 30px; background: linear-gradient(to bottom, #ffe0b2, #d32f2f); position: relative;">
                    <div style="position: absolute; top: calc({markerPosition}% - 5px); left: -8px; width: 0; height: 0; border-left: 8px solid #1e97f3; border-top: 5px solid transparent; border-bottom: 5px solid transparent;"></div>

                    <!-- Add value labels to the gradient bar -->
                    <div style="position: absolute; top: calc(10% - 5px); left: 4px; font-size: 9px;">2000</div>
                    <div style="position: absolute; top: calc(30% - 5px); left: 4px; font-size: 9px;">4500</div>
                    <div style="position: absolute; top: calc(50% - 5px); left: 4px; font-size: 9px;">7000</div>
                    <div style="position: absolute; top: calc(70% - 5px); left: 4px; font-size: 9px;">9500</div>
                    <div style="position: absolute; top: calc(90% - 5px); left: 4px; font-size: 9px;">12000</div>
                </div>
                <div style="font-size: 10px; margin-left: 0.5rem;">
                    <div>Low</div>
                    <div style="margin-top: 76px;">High</div>
                </div>
            </div>
        </div>
    `);

    // Add value labels to each column (inside the field)
    series.bullets.push(function () {
        return am5.Bullet.new(root, {
            locationX: 0.5,
            locationY: 0.5,
            sprite: am5.Label.new(root, {
                text: "{value}",
                fill: am5.color(0x000000), // Black text
                centerX: am5.percent(50), // Center horizontally
                centerY: am5.percent(50), // Center vertically
                populateText: true
            })
        });
    });

    // Apply heat rules for coloring based on value
    series.set("heatRules", [{
        target: series.columns.template,
        min: am5.color(0xffe0b2), // Light color for low values (light peach)
        max: am5.color(0xd32f2f), // Dark color for high values (dark red)
        dataField: "value",       // This will control the color intensity
        key: "fill",              // Use 'fill' for the actual color filling of the column
        minValue: minValue,           // Specify the lower range value
        maxValue: maxValue           // Specify the upper range value
    }]);

    // Add reversed heat legend to indicate the range of values
    var heatLegend = chart.rightAxesContainer.children.push(am5.HeatLegend.new(root, {
        orientation: "vertical", // Make it vertical
        endColor: am5.color(0xffe0b2),  // Light peach for low values
        startColor: am5.color(0xd32f2f),  // Dark red for high values
        height: am5.p100,  // Fill height of the chart
        width: 120,         // Adjust width for the gradient bar
        paddingRight: 20
    }));

    // Increase the width of the actual gradient bar
    heatLegend.markers.template.setAll({
        width: 60 // This controls the actual gradient bar's width
    });

    // Add "Low" and "High" labels for the reversed heat legend
    chart.rightAxesContainer.children.push(am5.Label.new(root, {
        text: "Low",
        fontSize: 14,
        x: am5.p50,
        y: am5.percent(10),
        centerX: am5.p50,
        dx: 30,
        dy: -20
    }));

    chart.rightAxesContainer.children.push(am5.Label.new(root, {
        text: "High",
        fontSize: 14,
        x: am5.p50,
        y: am5.percent(90),
        centerX: am5.p50,
        dx: 30,
        dy: -20
    }));

    // Add values along the reversed gradient bar
    for (var i = 0; i < 5; i++) {
        chart.rightAxesContainer.children.push(am5.Label.new(root, {
            text: (minValue + 1000 + 2500 * i).toString(),  // Minimum value
            fontSize: 14,
            x: am5.p50,
            y: am5.percent(10 + 20 * i),  // Adjust position for reversed direction
            centerX: am5.p50,
            dx: -20,
            dy: -20
        }));
    }

    // Use the data
    series.data.setAll(data);

    // Auto-populate X and Y axis category data
    var weekdays = [];
    var hours = [];
    am5.array.each(data, function (row) {
        if (weekdays.indexOf(row.weekday) == -1) {
            weekdays.push(row.weekday);
        }
        if (hours.indexOf(row.hour) == -1) {
            hours.push(row.hour);
        }
    });

    yAxis.data.setAll(hours.map(function (item) {
        return { hour: item };
    }));

    xAxis.data.setAll(weekdays.map(function (item) {
        return { weekday: item };
    }));

    // Make the chart animate on load
    chart.appear(1000, 100);

}); // end am5.ready()
